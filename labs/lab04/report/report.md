---
## Front matter
title: "Отчёт по лабораторной работе 4"
subtitle: "Базовая настройка HTTP-сервера Apache"
author: "Сейдалиев Тагиетдин Ровшенович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---


# Цель работы

Приобретение практических навыков по установке и базовому конфигурированию HTTP-сервера Apache.

# Выполнение

## Установка и базовая настройка HTTP-сервера

После запуска виртуальной машины `server` была выполнена установка группы пакетов **Basic Web Server**, включающей веб-сервер Apache и необходимые модули.

### Просмотр конфигурационных файлов

В каталоге `/etc/httpd/conf` расположены базовые настройки Apache:

- `httpd.conf` — основной конфигурационный файл;
- `magic` — база MIME-типов.

Содержимое каталога приведено на скриншоте:

Каталог `/etc/httpd/conf.d` содержит дополнительные конфигурационные модули:

- `autoindex.conf` — параметры автоиндексации;
- `fcgid.conf` — модуль FastCGI;
- `manual.conf` — доступ к документации Apache;
- `ssl.conf` — настройки SSL/TLS;
- `userdir.conf` — пользовательские директории;
- `welcome.conf` — приветственная страница.

![Просмотр конфигурационных файлов](Screenshot_1.png){ #fig:001 width=80% }

Эти файлы автоматически подгружаются сервером Apache и расширяют его конфигурацию.

## Разрешение HTTP-трафика в межсетевом экране

На узле `server` была выполнена настройка межсетевого экрана, разрешающая работу HTTP-сервиса.  
После добавления сервиса список доступных правил был успешно обновлён.

## Запуск HTTP-сервера

Служба Apache была активирована для автозапуска и запущена в текущей сессии.  
Создание символьной ссылки подтверждает корректную регистрацию в systemd.

![Запуск службы httpd](Screenshot_2.png){ #fig:002 width=90% }

Параллельно в другом терминале велось наблюдение за системным журналом, что позволило убедиться в успешной инициализации всех модулей веб-сервера.

## Проверка доступности веб-сервера

После запуска виртуальной машины `client` в браузере был открыт адрес:

`http://192.168.1.1`

Отобразилась тестовая страница Apache, подтверждающая корректную работу HTTP-сервера.

![Тестовая страница Apache](Screenshot_3.png){ #fig:003 width=80% }

## Анализ логов веб-сервера

### Лог ошибок

В журнале ошибок отображаются стандартные сообщения запуска Apache: загрузка модулей, активация SELinux-политик, запуск основного процесса.

### Лог доступа

При обращении к серверу с клиента фиксируются:

- запрос корневой страницы `/` с кодом 403;
- запрос встроенных ресурсов (`poweredby.png`, `icon.ico`) с кодами 200 и 404.

![Вывод журналов error_log и access_log](Screenshot_4.png){ #fig:004 width=100% }

Эти записи подтверждают, что:

- клиент успешно подключился к серверу,
- Apache корректно обрабатывает входящие HTTP-запросы,
- журналы ведутся в штатном режиме.

## Настройка виртуального хостинга для HTTP-сервера

Перед редактированием прямой и обратной зон DNS был остановлен сервис DNS.  
В файл прямой зоны добавлена запись для имени `www.trseidaliev.net`, указывающая на IP-адрес веб-сервера. Обновлённый файл прямой зоны отображён на скриншоте:

![Файл прямой зоны DNS](Screenshot_5.png){ #fig:005 width=85% }

В файл обратной зоны добавлена PTR-запись для имени `www.trseidaliev.net`, обеспечивающая корректное обратное разрешение адреса. Содержимое зоны показано на скриншоте:

![Файл обратной зоны DNS](Screenshot_6.png){ #fig:006 width=85% }

После редактирования были удалены журнальные файлы DNS-зон и вновь запущен DNS-сервер.

В каталоге `/etc/httpd/conf.d` были созданы два файла виртуальных хостов: для `server.trseidaliev.net` и для `www.trseidaliev.net`.

### Конфигурация `server.trseidaliev.net`

Файл содержит параметры администратора, директории сайта и пути к журналам сервера.  
Скриншот с содержимым файла:

![Конфигурация server.trseidaliev.net.conf](Screenshot_7.png){ #fig:007 width=80% }

### Конфигурация `www.trseidaliev.net`

Создан аналогичный файл конфигурации для хоста `www.trseidaliev.net`, содержащий собственный корневой каталог и журналы.

![Конфигурация www.trseidaliev.net.conf](Screenshot_8.png){ #fig:008 width=80% }

## Создание веб-контента для виртуальных хостов

В каталоге `/var/www/html/server.trseidaliev.net` создана тестовая HTML-страница с приветственным сообщением.  
Содержимое страницы:

![index.html для server.trseidaliev.net](Screenshot_9.png){ #fig:009 width=80% }

В каталоге `/var/www/html/www.trseidaliev.net` создана страница с аналогичной структурой, но соответствующим текстом.

![index.html для www.trseidaliev.net](Screenshot_10.png){ #fig:010 width=80% }

Для корректной работы веб-сервера установлен владелец каталогов `/var/www` — пользователь и группа `apache`.  
После этого восстановлены контексты SELinux для каталогов `/etc`, `/var/named` и `/var/www`.

Завершением этапа стал перезапуск HTTP-сервера. Фрагмент выполнения операций отражён на скриншоте:

![Применение контекстов SELinux и перезапуск сервиса](Screenshot_11.png){ #fig:011 width=100% }

## Проверка работы виртуальных хостов

На виртуальной машине `client` выполнена проверка доступности обоих виртуальных сайтов через веб-браузер.

При открытии адреса отображается корректная тестовая страница:

![Результат server.trseidaliev.net](Screenshot_12.png){ #fig:012 width=80% }

Переход на адрес `www.trseidaliev.net` также приводит к отображению корректной страницы:

![Результат www.trseidaliev.net](Screenshot_13.png){ #fig:013 width=80% }

Обе страницы доступны, что подтверждает корректную настройку виртуального хостинга.

# Внесение изменений во внутреннее окружение виртуальной машины

## Подготовка каталога для размещения конфигураций

На виртуальной машине `server` был открыт каталог `/vagrant/provision/server/`, в котором созданы подкаталоги для файлов конфигурации HTTP-сервера.  
Создана структура каталогов для хранения содержимого `/etc/httpd/conf.d` и `/var/www/html`.

На скриншоте отражён процесс создания каталогов и копирования актуальных конфигурационных файлов:

![Создание структуры каталогов и копирование HTTP-конфигураций](Screenshot_14.png){ #fig:014 width=90% }

В каталоге `/vagrant/provision/server/dns/` были созданы подкаталоги и выполнено копирование содержимого `/var/named/` — включая файлы зон прямого и обратного просмотра.  
При копировании обновлённые файлы перезаписали исходные шаблоны.

В каталоге `/vagrant/provision/server/` был создан файл `http.sh`, которому назначены права на исполнение.  
Этот файл предназначен для автоматизации развёртывания HTTP-сервера и переноса конфигураций в систему.

![Содержимое скрипта http.sh](Screenshot_15.png){ #fig:015 width=80% }

# Заключение

В ходе выполнения лабораторной работы были последовательно развернуты и настроены ключевые сетевые сервисы и элементы инфраструктуры виртуальной среды:

- проведено обновление файлов прямой и обратной зон DNS-сервера, после чего сервер имен успешно перезапущен;
- сконфигурированы виртуальные хосты `server.trseidaliev.net` и `www.trseidaliev.net`, для каждого подготовлено собственное содержимое веб-каталогов;
- проверена доступность виртуальных сайтов с клиентской машины, что подтвердило корректность DNS-разрешения имён и работу виртуального хостинга Apache;
- обеспечено создание и сохранение структуры каталогов в директории `/vagrant/provision/`, что позволит повторно использовать все подготовленные настройки при дальнейшем развёртывании.

# Контрольные вопросы

## 1. Через какой порт по умолчанию работает Apache?

Apache использует **порт 80** для обработки HTTP-запросов.  
Этот порт является стандартным для незащищённого веб-трафика.

## 2. Под каким пользователем запускается Apache и к какой группе относится этот пользователь?

В большинстве дистрибутивов Linux (включая Rocky Linux) Apache запускается от имени пользователя **apache** и принадлежит группе **apache**.  
Это обеспечивает изоляцию и защищённость веб-сервера.

## 3. Где располагаются лог-файлы веб-сервера? Что можно по ним отслеживать?

Логи Apache находятся в каталоге:

```
/var/log/httpd/
```

Основные файлы:

- **access_log** — содержит информацию о всех HTTP-запросах к серверу;  
  по нему отслеживают посещаемость, методы запросов, IP-адреса клиентов.

- **error_log** — фиксирует ошибки работы сервера и модулей;  
  используется для диагностики и устранения неполадок.

## 4. Где по умолчанию содержится контент веб-серверов?

Стандартный каталог, из которого Apache отдаёт веб-контент:

```
/var/www/html/
```

Виртуальные хосты могут иметь собственные каталоги, например:

```
/var/www/html/server.trseidaliev.net/
```

## 5. Каким образом реализуется виртуальный хостинг? Что он даёт?

Виртуальный хостинг реализуется через отдельные конфигурационные файлы в:

```
/etc/httpd/conf.d/
```

Каждый виртуальный хост включает свои параметры:

- доменное имя (ServerName),
- корневой каталог (DocumentRoot),
- собственные журналы,
- уникальные настройки.

**Виртуальный хостинг позволяет:**

- размещать несколько независимых сайтов на одном сервере;
- разделять конфигурацию, логи и каталоги контента;
- обслуживать разные доменные имена с одного IP-адреса.

