---
## Front matter
title: "Отчёт по лабораторной работе 12"
subtitle: "Синхронизация времени"
author: "Сейдалиев Тагиетдин Ровшенович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Получение навыков по управлению системным временем и настройке синхронизации времени.

# Выполнение

## Настройка параметров времени и синхронизации на сервере и клиенте

На сервере и клиенте была выполнена команда timedatectl, что позволило определить текущую временную зону, состояние синхронизации и параметры системных часов.  
Обе машины работают в зоне Europe/Moscow (MSK, +0300), сетевой сервис синхронизации активен, а системные часы синхронизированы.

Команда date отобразила локальное системное время, скорректированное службой синхронизации chrony.

Команда hwclock показала текущее аппаратное время RTC, соответствующее системному времени.

## Управление синхронизацией времени

С помощью команды chronyc sources был получен список источников времени, их задержки, состояние доступности и точность.

На сервере используются внешние публичные NTP-источники:

![Источники времени на сервере](Screenshot_1.png){ #fig:010 width=80% }

Основные параметры полей:

- MS — статус источника (символ * означает выбранный лучший источник).
- Name/IP address — используемый сервер.
- Stratum — уровень точности (меньше — лучше).
- LastRx — время с момента последнего ответа сервера.
- Last sample — смещение системного времени относительно источника.

До изменения конфигурации у клиента также были подключены внешние источники:

![Источники времени на клиенте до настройки](Screenshot_2.png){ #fig:011 width=80% }

### Настройка сервера в качестве NTP-сервера для сети

В конфигурационный файл сервера был добавлен разрешающий доступ для подсети 192.168.0.0/16:

![Фрагмент chrony.conf на сервере](Screenshot_3.png){ #fig:012 width=80% }

После внесения изменений служба chronyd была перезапущена, а межсетевой экран настроен на разрешение трафика NTP:

![Перезапуск chronyd и настройка firewall](Screenshot_4.png){ #fig:013 width=80% }

### Настройка клиента на использование сервера

В конфигурации клиента была добавлена строка со ссылкой на сервер:

![Фрагмент chrony.conf на клиенте](Screenshot_5.png){ #fig:014 width=80% }

Остальные строки server были удалены. После перезапуска службы клиент начал использовать сервер как основной источник времени:

![Источники времени на клиенте после настройки](Screenshot_6.png){ #fig:015 width=80% }

Статус источника показывает, что клиент получает данные, и через несколько опросов сервер станет главным источником синхронизации.

## Настройка окружения виртуальных машин для автоматизации

Файл chrony.conf сервера был сохранён в каталог /vagrant/provision/server/ntp/etc:

Был создан скрипт автоматического провижининга ntp.sh:

![Скрипт ntp.sh для сервера](Screenshot_7.png){ #fig:017 width=70% }

Файл конфигурации клиента был вынесен в /vagrant/provision/client/ntp/etc:

Создан скрипт автоматизации ntp.sh для клиента:

![Скрипт ntp.sh для клиента](Screenshot_8.png){ #fig:019 width=70% }


# Заключение

В ходе выполнения работы:

- изучены и проанализированы параметры времени на сервере и клиенте с использованием команд timedatectl, date и hwclock;
- проверено текущее состояние синхронизации и источников времени с помощью chronyc sources;
- сервер настроен как NTP-узел для локальной сети с разрешением доступа подсети 192.168.0.0/16 и корректной настройкой брандмауэра;
- клиент переведён на использование сервера как основного источника времени;
- выполнена автоматизация настройки chrony для серверной и клиентской машин через систему провижининга Vagrant;
- созданы и размещены в структуре проекта файлы конфигурации и скрипты ntp.sh для автоматического применения настроек;
- проверена корректность синхронизации времени после внесённых изменений, а также состояние NTP-источников на обеих виртуальных машинах.

# Контрольные вопросы

## 1. Почему важна точная синхронизация времени для служб баз данных?

Службы баз данных зависят от корректного времени, потому что временные метки используются при транзакциях, репликации, журналировании и блокировках.  
Несогласованность времени может привести к повреждению данных, нарушению целостности транзакций или ошибкам репликации.

## 2. Почему служба проверки подлинности Kerberos сильно зависит от правильной синхронизации времени?

Kerberos использует временные метки в процессе аутентификации для защиты от повторного использования пакетов (replay attacks).  
Если разница во времени между клиентом и сервером превышает допустимый порог (обычно 5 минут), выдача тикета будет отклонена.

## 3. Какая служба используется по умолчанию для синхронизации времени на RHEL 7?

На RHEL 7 по умолчанию используется служба **chronyd** из пакета **chrony**.

## 4. Какова страта по умолчанию для локальных часов?

Локальные часы без внешних источников имеют значение страты **10**.  
Это значение указывает, что системное время не синхронизировано с сетевыми источниками и считается наименее точным.

## 5. Какой порт брандмауэра должен быть открыт, если вы настраиваете свой сервер как одноранговый узел NTP?

Для службы NTP должен быть открыт порт **123/UDP**.

## 6. Какую строку нужно включить в конфигурационный файл chrony, если вы хотите быть сервером времени, даже если внешние серверы NTP недоступны?

Необходимо добавить указание на локальный источник времени: `local stratum 10`

Эта строка разрешает системе выступать в роли NTP-сервера при отсутствии внешних источников.

## 7. Какую страту имеет хост, если нет текущей синхронизации времени NTP?

Хост, не имеющий активной синхронизации, получает страту **16**, что означает недостоверное время (unsynchronized).

## 8. Какую команду можно использовать на сервере с chrony, чтобы узнать, с какими серверами он синхронизируется?

Для просмотра активных источников времени используется команда: `chronyc sources`

## 9. Как получить подробную статистику текущих настроек времени для процесса chrony?

Для детальной информации используется команда: `chronyc tracking`

Она показывает состояние синхронизации, смещения, стабильность и параметры локальных часов.



